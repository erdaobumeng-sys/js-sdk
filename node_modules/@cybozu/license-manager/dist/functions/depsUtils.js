"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isMatchVersion = exports.isMatchName = exports.isMatchPackage = exports.isMatchLicense = exports.getLicense = void 0;
const getLicense = (dep, overrideLicense) => {
    if (overrideLicense) {
        const result = overrideLicense(dep);
        if (result)
            return result;
    }
    if (typeof dep.license === "string")
        return dep.license;
    if (typeof dep.license === "object")
        return dep.license.type;
    return "";
};
exports.getLicense = getLicense;
const isMatchLicense = (dep, licensePattern) => {
    const depLicense = (0, exports.getLicense)(dep);
    if (licensePattern instanceof RegExp) {
        return licensePattern.test(depLicense);
    }
    return depLicense === licensePattern.trim();
};
exports.isMatchLicense = isMatchLicense;
const isMatchPackage = (dep, packagePattern) => {
    if (packagePattern instanceof RegExp) {
        return packagePattern.test(`${dep.name}@${dep.version}`);
    }
    let [, version = ""] = removeScopePrefix(packagePattern).split("@");
    version = version.trim();
    if (!(0, exports.isMatchName)(dep, packagePattern))
        return false;
    if (!version || (0, exports.isMatchVersion)(dep, version))
        return true;
    return false;
};
exports.isMatchPackage = isMatchPackage;
const isMatchName = (dep, comparePackageName) => {
    const depName = removeScopePrefix(dep.name);
    let [name = ""] = removeScopePrefix(comparePackageName).split("@");
    name = name.trim();
    const isStrictNameMatched = name === depName;
    const isScopeMatched = name.endsWith("/*") && depName.startsWith(name.substring(0, name.length - 2));
    return isStrictNameMatched || isScopeMatched;
};
exports.isMatchName = isMatchName;
const isMatchVersion = (dep, compareVersion) => {
    return compareVersion === "*" || compareVersion === "all" || dep.version === compareVersion;
};
exports.isMatchVersion = isMatchVersion;
const removeScopePrefix = (packagePattern) => {
    return packagePattern.startsWith("@") ? packagePattern.substring(1) : packagePattern;
};
