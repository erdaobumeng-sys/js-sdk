{"version":3,"file":"repositoryCommand.js","names":["cwd: string","command: RepositoryCommand","args: readonly string[]"],"sources":["../src/repositoryCommand.ts"],"sourcesContent":["import { execFileAsync, execFileSync } from \"./exec.js\";\nimport {} from \"child_process\";\n\ntype RepositoryCommand = \"git\" | \"hg\" | \"sl\" | \"svn\" | \"svnadmin\" | \"svnrdump\";\n\nconst environment = {\n  git: {\n    // non-interactive\n    GIT_TERMINAL_PROMPT: \"0\",\n    // don't use global config\n    GIT_CONFIG_GLOBAL: \"/dev/null\",\n    GIT_CONFIG_SYSTEM: \"/dev/null\",\n    // user config\n    GIT_COMMITTER_NAME: \"alan\",\n    GIT_COMMITTER_EMAIL: \"alan@example.com\",\n    GIT_AUTHOR_NAME: \"alan\",\n    GIT_AUTHOR_EMAIL: \"alan@example.com\",\n  },\n  hg: {\n    // don't use global config\n    HGRCPATH: \"/dev/null\",\n    // don't use global config\n    HGUSER: \"alan\",\n    EMAIL: \"alan@example.com\",\n  },\n  sl: {\n    // don't use global config\n    HGRCPATH: \"/dev/null\",\n    // don't use global config\n    HGUSER: \"alan\",\n    EMAIL: \"alan@example.com\",\n  },\n  svn: {},\n  svnadmin: {},\n  svnrdump: {},\n} as const satisfies Record<RepositoryCommand, NodeJS.ProcessEnv>;\n\nexport async function repositoryExec(\n  cwd: string,\n  command: RepositoryCommand,\n  args: readonly string[],\n): Promise<string> {\n  // const msg = `Executing command: ${command} ${args.join(\" \")}`;\n  // console.time(msg);\n  return execFileAsync(command, args, {\n    cwd: cwd,\n    encoding: \"utf8\",\n    env: {\n      ...process.env,\n      ...environment[command],\n    },\n  }).then(({ stdout, stderr }) => {\n    // console.timeEnd(msg);\n    return stderr ? Promise.reject(new Error(stderr.trim())) : stdout.trim();\n  });\n}\n\nexport function repositoryExecSync(\n  cwd: string,\n  command: RepositoryCommand,\n  args: readonly string[],\n): string {\n  // const msg = `Executing command: ${command} ${args.join(\" \")}`;\n  // console.time(msg);\n  const result = execFileSync(command, args, {\n    cwd: cwd,\n    encoding: \"utf8\",\n    env: {\n      ...process.env,\n      ...environment[command],\n    },\n  }).trim();\n  // console.timeEnd(msg);\n  return result;\n}\n\nexport const createExecForDirectory = (\n  cwd: string,\n): ((command: RepositoryCommand, args: readonly string[]) => Promise<string>) =>\n  repositoryExec.bind(null, cwd);\n\n// Not being used.\n// export const createExecSyncForDirectory = (\n//   cwd: string,\n// ): ((command: RepositoryCommand, args: readonly string[]) => string) =>\n//   repositoryExecSync.bind(null, cwd);\n"],"mappings":";;;AAKA,MAAM,cAAc;CAClB,KAAK;EAEH,qBAAqB;EAErB,mBAAmB;EACnB,mBAAmB;EAEnB,oBAAoB;EACpB,qBAAqB;EACrB,iBAAiB;EACjB,kBAAkB;CACnB;CACD,IAAI;EAEF,UAAU;EAEV,QAAQ;EACR,OAAO;CACR;CACD,IAAI;EAEF,UAAU;EAEV,QAAQ;EACR,OAAO;CACR;CACD,KAAK,CAAE;CACP,UAAU,CAAE;CACZ,UAAU,CAAE;AACb;AAED,eAAsB,eACpBA,KACAC,SACAC,MACiB;AAGjB,QAAO,cAAc,SAAS,MAAM;EAC7B;EACL,UAAU;EACV,KAAK;GACH,GAAG,QAAQ;GACX,GAAG,YAAY;EAChB;CACF,EAAC,CAAC,KAAK,CAAC,EAAE,QAAQ,QAAQ,KAAK;AAE9B,SAAO,SAAS,QAAQ,OAAO,IAAI,MAAM,OAAO,MAAM,EAAE,GAAG,OAAO,MAAM;CACzE,EAAC;AACH;AAED,SAAgB,mBACdF,KACAC,SACAC,MACQ;CAGR,MAAM,SAAS,aAAa,SAAS,MAAM;EACpC;EACL,UAAU;EACV,KAAK;GACH,GAAG,QAAQ;GACX,GAAG,YAAY;EAChB;CACF,EAAC,CAAC,MAAM;AAET,QAAO;AACR;AAED,MAAa,yBAAyB,CACpCF,QAEA,eAAe,KAAK,MAAM,IAAI"}