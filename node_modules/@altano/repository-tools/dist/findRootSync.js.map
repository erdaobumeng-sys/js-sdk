{"version":3,"file":"findRootSync.js","names":["cwd: string","directory: string","e: unknown"],"sources":["../src/findRootSync.ts"],"sourcesContent":["import { repositoryExecSync } from \"./repositoryCommand.js\";\n\nfunction findGitRoot(cwd: string): string {\n  return repositoryExecSync(cwd, \"git\", [\n    \"rev-parse\",\n    \"--quiet\",\n    \"--show-toplevel\",\n  ]);\n}\n\nfunction findSaplingRoot(cwd: string): string {\n  return repositoryExecSync(cwd, \"sl\", [\"--quiet\", \"root\"]);\n}\n\nfunction findMercurialRoot(cwd: string): string {\n  return repositoryExecSync(cwd, \"hg\", [\"--quiet\", \"root\"]);\n}\n\nfunction findSubversionRoot(cwd: string): string {\n  return repositoryExecSync(cwd, \"svn\", [\"info\", \"--show-item\", \"wc-root\"]);\n}\n\n// Version control systems to check for. Highest-precedence checks go first.\nconst findMethods = [\n  findGitRoot, // most used and fastest check\n  findSubversionRoot, // next highest market share\n  findSaplingRoot, // much smaller market share, but much faster\n  findMercurialRoot, // slow af\n] as const;\n\n/**\n * Find the root path of the repository containing the given directory.\n *\n * @returns null if not found or the path of the repository root as a string\n */\nexport function findRootSync(\n  /**\n   * The directory path of anything in a version-controlled repository\n   */\n  directory: string,\n): string | null {\n  for (const method of findMethods) {\n    try {\n      const result = method(directory);\n      if (result != null && result !== \"\") {\n        return result;\n      }\n    } catch (e: unknown) {\n      if (e instanceof Error && \"code\" in e && e.code === \"ENOTDIR\") {\n        // rethrow error when given directory path isn't a directory\n        throw new Error(`Given path isn't a directory: ${directory}`);\n      }\n    }\n  }\n  return null;\n}\n"],"mappings":";;;AAEA,SAAS,YAAYA,KAAqB;AACxC,QAAO,mBAAmB,KAAK,OAAO;EACpC;EACA;EACA;CACD,EAAC;AACH;AAED,SAAS,gBAAgBA,KAAqB;AAC5C,QAAO,mBAAmB,KAAK,MAAM,CAAC,WAAW,MAAO,EAAC;AAC1D;AAED,SAAS,kBAAkBA,KAAqB;AAC9C,QAAO,mBAAmB,KAAK,MAAM,CAAC,WAAW,MAAO,EAAC;AAC1D;AAED,SAAS,mBAAmBA,KAAqB;AAC/C,QAAO,mBAAmB,KAAK,OAAO;EAAC;EAAQ;EAAe;CAAU,EAAC;AAC1E;AAGD,MAAM,cAAc;CAClB;CACA;CACA;CACA;AACD;;;;;;AAOD,SAAgB,aAIdC,WACe;AACf,MAAK,MAAM,UAAU,YACnB,KAAI;EACF,MAAM,SAAS,OAAO,UAAU;AAChC,MAAI,UAAU,QAAQ,WAAW,GAC/B,QAAO;CAEV,SAAQC,GAAY;AACnB,MAAI,aAAa,SAAS,UAAU,KAAK,EAAE,SAAS,UAElD,OAAM,IAAI,OAAO,gCAAgC,UAAU;CAE9D;AAEH,QAAO;AACR"}