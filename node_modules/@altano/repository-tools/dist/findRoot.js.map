{"version":3,"file":"findRoot.js","names":["directory: string","e: unknown"],"sources":["../src/findRoot.ts"],"sourcesContent":["import { repositoryExec } from \"./repositoryCommand.js\";\n\nasync function findGitRoot(directory: string): Promise<string> {\n  return repositoryExec(directory, \"git\", [\n    \"rev-parse\",\n    \"--quiet\",\n    \"--show-toplevel\",\n  ]);\n}\n\nasync function findSaplingRoot(directory: string): Promise<string> {\n  return repositoryExec(directory, \"sl\", [\"--quiet\", \"root\"]);\n}\n\nasync function findMercurialRoot(directory: string): Promise<string> {\n  return repositoryExec(directory, \"hg\", [\"--quiet\", \"root\"]);\n}\n\nasync function findSubversionRoot(directory: string): Promise<string> {\n  return repositoryExec(directory, \"svn\", [\"info\", \"--show-item\", \"wc-root\"]);\n}\n\n// Version control systems to check for. Highest-precedence checks go first.\nconst findMethods = [\n  findGitRoot, // most used and fastest check\n  findSubversionRoot, // next highest market share\n  findSaplingRoot, // much smaller market share, but much faster\n  findMercurialRoot, // slow af\n] as const;\n\n/**\n * Find the root path of the repository containing the given directory.\n *\n * @returns null if not found or the path of the repository root as a string\n */\nexport async function findRoot(\n  /**\n   * The directory path of anything in a version-controlled repository\n   */\n  directory: string,\n): Promise<string | null> {\n  for (const method of findMethods) {\n    try {\n      const result = await method(directory);\n      if (result != null && result !== \"\") {\n        return result;\n      }\n    } catch (e: unknown) {\n      if (e instanceof Error && \"code\" in e && e.code === \"ENOTDIR\") {\n        // rethrow error when given directory path isn't a directory\n        throw new Error(`Given path isn't a directory: ${directory}`);\n      }\n    }\n  }\n  return null;\n}\n"],"mappings":";;;AAEA,eAAe,YAAYA,WAAoC;AAC7D,QAAO,eAAe,WAAW,OAAO;EACtC;EACA;EACA;CACD,EAAC;AACH;AAED,eAAe,gBAAgBA,WAAoC;AACjE,QAAO,eAAe,WAAW,MAAM,CAAC,WAAW,MAAO,EAAC;AAC5D;AAED,eAAe,kBAAkBA,WAAoC;AACnE,QAAO,eAAe,WAAW,MAAM,CAAC,WAAW,MAAO,EAAC;AAC5D;AAED,eAAe,mBAAmBA,WAAoC;AACpE,QAAO,eAAe,WAAW,OAAO;EAAC;EAAQ;EAAe;CAAU,EAAC;AAC5E;AAGD,MAAM,cAAc;CAClB;CACA;CACA;CACA;AACD;;;;;;AAOD,eAAsB,SAIpBA,WACwB;AACxB,MAAK,MAAM,UAAU,YACnB,KAAI;EACF,MAAM,SAAS,MAAM,OAAO,UAAU;AACtC,MAAI,UAAU,QAAQ,WAAW,GAC/B,QAAO;CAEV,SAAQC,GAAY;AACnB,MAAI,aAAa,SAAS,UAAU,KAAK,EAAE,SAAS,UAElD,OAAM,IAAI,OAAO,gCAAgC,UAAU;CAE9D;AAEH,QAAO;AACR"}